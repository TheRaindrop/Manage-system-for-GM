webpackJsonp([15],{"1kXq":function(t,e){},"98cJ":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("ifoU"),i=a.n(s),o=a("woOf"),n=a.n(o),r={data:function(){var t=this;return{show:!1,loading:!1,userData:[],editModel:!1,modelData:{editContact:!1,addressEdit:!1,emailEdit:!1,invoiceEdit:!1},formEditUser:{email:""},ruleEditUser:{email:[{type:"email",required:!1,message:"邮箱格式错误",trigger:"blur"}]},formContact:{host_id:"",id:"",name:"",phone:"",sex:1,card_type:"NI",card_number:"",birthday:""},ruleContact:{name:[{required:!0,message:"请填写联系人姓名",trigger:"blur"}],phone:[{validator:function(t,e,a){null===e||""===e?a():/^1[345789]\d{9}$/.test(e)?a():a(new Error("电话号码格式错误，请仔细核对"))},trigger:"blur"}],card_number:[{validator:function(e,a,s){"NI"===t.formContact.card_type?null===a||""===a?s(new Error("身份证号不能为空")):t.isIDCard(a)?s():s(new Error("身份证号码格式错误")):"ID"===t.formContact.card_type||null!==a&&""!==a?s():s(new Error("证件号码不能为空"))},trigger:"blur"}],birthday:[{required:!0,message:"请填写出生日期",trigger:"blur"}]},page:{page_num:null,total_pages:null,total_items:null},searchData:""}},methods:{searchUser:function(){var t=this;""!==this.searchData?(this.loading=!0,this.$http.get("/users",{params:{phone:this.searchData}}).then(function(e){console.log(e.data);var a=e.data.results;for(var s in a)a[s].hidden=!0;t.userData=a,t.loading=!1,t.page.page_num=e.data.page_num,t.page.total_pages=e.data.total_pages,t.page.total_items=e.data.total_items}).catch(function(t){console.log(t)})):this.getUserData()},hostEdit:function(t){this.editModel=!0,this.formEditUser=n()({},t)},getUserData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this;this.loading=!0,this.$http.get("/users",{params:{page:t}}).then(function(t){console.log(t.data);var a=t.data.results;for(var s in a)a[s].hidden=!0;e.userData=a,e.loading=!1,e.page.page_num=t.data.page_num,e.page.total_pages=t.data.total_pages,e.page.total_items=t.data.total_items}).catch(function(t){console.log(t)})},pageChange:function(t){this.getUserData(t)},editConfirm:function(t){var e=this,a=this;this.$refs[t].validate(function(t){t?e.$http.patch("/users/"+a.formEditUser.id,{nickname:a.formEditUser.nickname,email:a.formEditUser.email}).then(function(t){a.editModel=!1,a.loading=!0,a.$message({message:"修改成功",type:"success"}),a.getUserData(a.page.page_num)}).catch(function(t){console.log(t)}):e.$message("邮箱格式错误")})},editCancel:function(t){this.formEditUser={},this.editModel=!1,this.$message("取消编辑")},editContact:function(t,e){this.$refs.formContact&&this.$refs.formContact.resetFields(),this.modelData.editContact=!0,this.formContact.host_id=e,this.formContact.id=t.id,this.formContact.phone=t.phone,this.formContact.name=t.name,this.formContact.sex=t.sex,this.formContact.card_type=t.card_type,this.formContact.card_number=t.card_number,this.formContact.birthday=t.birthday.substr(0,10)},addContact:function(t){this.$refs.formContact&&this.$refs.formContact.resetFields(),this.modelData.editContact=!0,this.formContact.host_id=t,this.formContact.id="",this.formContact.phone="",this.formContact.name="",this.formContact.sex=1,this.formContact.card_type="NI",this.formContact.card_number="",this.formContact.birthday=""},ctcConfirm:function(t){var e=this;this.$refs[t].validate(function(t){if(t){if("NI"===e.formContact.card_type){var a=e.formContact.card_number.substring(6,10)+"-"+e.formContact.card_number.substring(10,12)+"-"+e.formContact.card_number.substring(12,14);e.formContact.birthday=new Date(a),console.log(e.formContact.birthday,a)}e.formContact.id?(console.log("====================",e.formContact.birthday),e.$http.patch("/users/contacts/"+e.formContact.id,{name:e.formContact.name,phone:e.formContact.phone||null,card_type:e.formContact.card_type,card_number:e.formContact.card_number,sex:e.formContact.sex,birthday:e.formContact.birthday+"T00:00",owner:e.formContact.host_id}).then(function(t){e.modelData.editContact=!1,e.loading=!0,e.$message({message:"修改成功",type:"success"}),e.getUserData(e.page.page_num)}).catch(function(t){console.log(t)})):e.$http.post("/users/contacts",{name:e.formContact.name,phone:e.formContact.phone||null,card_type:e.formContact.card_type,card_number:e.formContact.card_number,sex:e.formContact.sex,birthday:e.formContact.birthday+"T00:00",owner:e.formContact.host_id}).then(function(t){e.modelData.editContact=!1,e.loading=!0,e.$message({message:"添加成功",type:"success"}),e.getUserData(e.page.page_num)}).catch(function(t){console.log(t)})}else e.$message({message:"格式不正确",type:"error"})})},ctcDelete:function(){var t=this;this.$confirm("确认删除？").then(function(){t.$http.delete("/users/contacts/"+t.formContact.id).then(function(e){t.modelData.editContact=!1,t.loading=!0,t.$message({message:"删除成功",type:"success"}),t.getUserData(t.page.page_num)}).catch(function(t){console.log(t)})}).catch(function(t){console.log(t)})},isIDCard:function(t){var e=new i.a([[11,"北京"],[12,"天津"],[13,"河北"],[14,"山西"],[15,"内蒙古"],[21,"辽宁"],[22,"吉林"],[23,"黑龙江"],[31,"上海"],[32,"江苏"],[33,"浙江"],[34,"安徽"],[35,"福建"],[36,"江西"],[37,"山东"],[41,"河南"],[42,"湖北"],[43,"湖南"],[44,"广东"],[45,"广西"],[46,"海南"],[50,"重庆"],[51,"四川"],[52,"贵州"],[53,"云南"],[54,"西藏"],[61,"陕西"],[62,"甘肃"],[63,"青海"],[64,"新疆"],[71,"台湾"],[81,"香港"],[82,"澳门"],[91,"外国"]]),a=["1","0","X","9","8","7","6","5","4","3","2"],s=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2];if(null===t||18!==t.length)return console.log("false No.1"),!1;for(var o=t.toUpperCase().split(""),n=0,r=0;r<o.length&&(r!==o.length-1||"X"!==o[r]);r++){if(o[r]<"0"||o[r]>"9")return console.log("false No.2"),!1;r<o.length-1&&(n+=(o[r]-"0")*s[r])}if(!e.has(parseInt(t.substring(0,2))))return console.log("false No.3"),!1;var l=parseInt(t.substring(6,10)),c=(new Date).getFullYear();if(l<1900||l>c)return console.log("false No.4"),!1;var d=parseInt(t.substring(10,12));if(d<1||d>12)return console.log("false No.5"),!1;var m=parseInt(t.substring(12,14));return m<1||m>31?(console.log("false No.6"),!1):(console.log("false No.7",o[o.length-1],a[n%11]),o[o.length-1]===a[n%11])}},created:function(){this.getUserData()}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("用户信息列表")]),a("div",{staticClass:"methods-right"},[a("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{size:"small",type:"tel",placeholder:"输入机主号码搜索"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.searchUser(e)}},model:{value:t.searchData,callback:function(e){t.searchData=e},expression:"searchData"}}),a("el-button",{attrs:{type:"success",size:"small"},on:{click:t.searchUser}},[t._v("搜索机主")])],1)]),a("div",{staticClass:"user-table"},[a("div",{staticClass:"table-head"},[a("el-row",{staticStyle:{width:"100%"},attrs:{gutter:10}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"table-head__item"},[t._v("昵称")])]),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"table-head__item"},[t._v("手机")])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"table-head__item"},[t._v("关联旅客")])]),a("el-col",{attrs:{span:3}},[a("div",{staticClass:"table-head__item"},[t._v("通讯地址")])]),a("el-col",{attrs:{span:3}},[a("div",{staticClass:"table-head__item"},[t._v("邮箱地址")])]),a("el-col",{attrs:{span:3}},[a("div",{staticClass:"table-head__item"},[t._v("发票信息")])]),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"table-head__item"},[t._v("操作")])])],1)],1),t.userData.length>0?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"table-body"},["string"!=typeof t.userData?a("div",{staticClass:"table-body__block"},[t._l(t.userData,function(e,s){return a("div",{staticClass:"host-line",class:{"host-line__hide":e.hidden}},[a("el-row",{staticStyle:{width:"100%"},attrs:{gutter:10}},[a("el-col",{staticClass:"host-line__element",attrs:{span:2}},[a("div",{staticClass:"host-line__item"},[t._v(t._s(e.nickname))])]),a("el-col",{staticClass:"host-line__element",attrs:{span:2}},[a("div",{staticClass:"host-line__item"},[t._v(t._s(e.phone))])]),a("el-col",{staticClass:"host-line__element",attrs:{span:5}},[a("div",{staticClass:"host-line__item"},[t._l(e.contacts,function(s,i){return a("el-card",{key:i,staticClass:"edit-card friend",attrs:{"body-style":{padding:"10px"}}},[a("div",{staticClass:"friend__name friend__item"},[a("span",{staticClass:"friend__item_label"},[t._v("姓名：")]),a("span",[t._v(t._s(s.name))])]),a("div",{staticClass:"friend__phone friend__item"},[a("span",{staticClass:"friend__item_label"},[t._v("手机：")]),a("span",[t._v(t._s(s.phone))])]),a("div",{staticClass:"friend__id friend__item"},[a("span",{staticClass:"friend__item_label"},[t._v("ID：")]),a("span",[t._v(t._s(s.card_number))])]),a("div",{staticClass:"edit-card__btn"},[a("i",{staticClass:"el-icon-edit-outline icon_text",attrs:{title:"编辑"},on:{click:function(a){t.editContact(s,e.id)}}})])])}),a("div",{staticClass:"add-friend"},[a("el-button",{staticClass:"btn-add",on:{click:function(a){t.addContact(e.id)}}},[a("i",{staticClass:"el-icon-plus"})])],1)],2)]),a("el-col",{staticClass:"host-line__element",attrs:{span:3}},[a("div",{staticClass:"host-line__item"},[t._l(e.Address,function(e,i){return a("div",{staticClass:"address"},[a("span",[a("el-card",{staticClass:"edit-card",attrs:{"body-style":{padding:"10px"}}},[t._v(t._s(t.userData[s].Address[i])),a("div",{staticClass:"edit-card__btn"},[a("i",{staticClass:"el-icon-edit-outline icon_text",attrs:{title:"编辑"},on:{click:function(t){}}})])])],1)])}),a("div",{staticClass:"add-address"},[a("el-button",{staticClass:"btn-add",on:{click:function(a){t.addAddress(e)}}},[a("i",{staticClass:"el-icon-plus"})])],1)],2)]),a("el-col",{staticClass:"host-line__element",attrs:{span:3}},[a("div",{staticClass:"host-line__item"},[a("div",{staticClass:"host-line__item"},[t._v(t._s(e.email))])])]),a("el-col",{staticClass:"host-line__element",attrs:{span:3}},[a("div",{staticClass:"host-line__item"},[t._l(e.Invoice,function(e,s){return a("el-card",{key:s,staticClass:"edit-card invoice",attrs:{"body-style":{padding:"10px"}}},[a("div",{staticClass:"invoice__title"},[a("span",[t._v(t._s(e.Title))])]),a("div",{staticClass:"invoice__num"},[a("span",[t._v(t._s(e.taxNo))])]),a("div",{staticClass:"edit-card__btn"},[a("i",{staticClass:"el-icon-edit-outline icon_text",attrs:{title:"编辑"},on:{click:function(t){}}})])])}),a("div",{staticClass:"add-invoice"},[a("el-button",{staticClass:"btn-add"},[a("i",{staticClass:"el-icon-plus"})])],1)],2)]),a("el-col",{staticClass:"host-line__element",attrs:{span:2}},[a("div",{staticClass:"host-line__item",staticStyle:{float:"left","min-width":"150px"}},[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){t.hostEdit(e)}}},[t._v("编辑")]),e.contacts.length>0?a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){e.hidden=!e.hidden}}},[e.hidden?a("span",[t._v("展开")]):a("span",[t._v("收起")])]):t._e()],1)])],1)],1)}),a("div",{staticClass:"page-block"},[a("el-pagination",{attrs:{layout:"prev, pager, next","page-count":t.page.total_pages,"current-page":t.page.page_num},on:{"current-change":t.pageChange}})],1)],2):t._e()]):a("div",[a("p",[t._v("未找到相关用户信息，请检查输入信息是否有误")])])]),a("el-dialog",{attrs:{title:"编辑用户",visible:t.editModel,width:"30%"},on:{"update:visible":function(e){t.editModel=e}}},[a("div",{staticClass:"content"},[a("el-form",{ref:"formEditUser",attrs:{model:t.formEditUser,rules:t.ruleEditUser,"label-width":"80px","label-position":"right"}},[a("el-form-item",{attrs:{label:"手机",prop:"phone"}},[a("el-input",{attrs:{disabled:"disabled"},model:{value:t.formEditUser.phone,callback:function(e){t.$set(t.formEditUser,"phone",e)},expression:"formEditUser.phone"}})],1),a("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[a("el-input",{model:{value:t.formEditUser.nickname,callback:function(e){t.$set(t.formEditUser,"nickname",e)},expression:"formEditUser.nickname"}})],1),a("el-form-item",{attrs:{label:"登录名",prop:"username"}},[a("el-input",{attrs:{disabled:"disabled"},model:{value:t.formEditUser.username,callback:function(e){t.$set(t.formEditUser,"username",e)},expression:"formEditUser.username"}})],1),a("el-form-item",{attrs:{label:"Email",prop:"email"}},[a("el-input",{model:{value:t.formEditUser.email,callback:function(e){t.$set(t.formEditUser,"email",e)},expression:"formEditUser.email"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.editCancel}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.editConfirm("formEditUser")}}},[t._v("确定")])],1)]),a("div",{staticClass:"user-model"},[a("el-dialog",{attrs:{title:"联系人",visible:t.modelData.editContact,width:"30%"},on:{"update:visible":function(e){t.$set(t.modelData,"editContact",e)}}},[a("el-form",{ref:"formContact",attrs:{model:t.formContact,rules:t.ruleContact,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{model:{value:t.formContact.name,callback:function(e){t.$set(t.formContact,"name",e)},expression:"formContact.name"}})],1),a("el-form-item",{attrs:{label:"电话",prop:"phone"}},[a("el-input",{model:{value:t.formContact.phone,callback:function(e){t.$set(t.formContact,"phone",e)},expression:"formContact.phone"}})],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-radio-group",{model:{value:t.formContact.sex,callback:function(e){t.$set(t.formContact,"sex",t._n(e))},expression:"formContact.sex"}},[a("el-radio",{attrs:{label:1}},[t._v("男")]),a("el-radio",{attrs:{label:2}},[t._v("女")])],1)],1),a("el-form-item",{attrs:{label:"证件类型",prop:"card_type"}},[a("el-select",{model:{value:t.formContact.card_type,callback:function(e){t.$set(t.formContact,"card_type",e)},expression:"formContact.card_type"}},[a("el-option",{attrs:{value:"NI",label:"身份证(默认)"}}),a("el-option",{attrs:{value:"PP",label:"护照"}}),a("el-option",{attrs:{value:"HX",label:"回乡证"}}),a("el-option",{attrs:{value:"TB",label:"台胞证"}}),a("el-option",{attrs:{value:"GA",label:"港澳通行证"}}),a("el-option",{attrs:{value:"HY",label:"国际海员证"}}),a("el-option",{attrs:{value:"ID",label:"其他"}})],1)],1),a("el-form-item",{attrs:{label:"证件号码",prop:"card_number"}},[a("el-input",{model:{value:t.formContact.card_number,callback:function(e){t.$set(t.formContact,"card_number",e)},expression:"formContact.card_number"}})],1),"NI"!==t.formContact.card_type?a("el-form-item",{attrs:{label:"出生日期",prop:"birthday"}},[a("el-date-picker",{attrs:{type:"date",placeolder:"选择出生日期","value-format":"yyyy-MM-dd"},model:{value:t.formContact.birthday,callback:function(e){t.$set(t.formContact,"birthday",e)},expression:"formContact.birthday"}})],1):t._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.formContact.id?a("el-button",{on:{click:t.ctcDelete}},[t._v("删除")]):t._e(),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.ctcConfirm("formContact")}}},[t._v("保存")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,l,!1,function(t){a("1kXq")},"data-v-02129025",null);e.default=c.exports}});
//# sourceMappingURL=15.8e6b3db440d4574e4dac.js.map